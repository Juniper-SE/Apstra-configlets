{
"id": "8955ec9c-49f5-421e-b60d-ad791320bcf7",
"ref_archs": [
    "two_stage_l3clos"
],
"created_at": "2024-10-02T08:52:27.601763Z",
"last_modified_at": "2024-10-02T11:13:03.999673Z",
"display_name": "Dynamic QoS Example Configlet",
"generators": [
    {
    "config_style": "junos",
    "template_text": "{# This configlet defines comprehensive QoS (Quality of Service) settings for Juniper devices #}\nsystem {\n    packet-forwarding-options {\n        no-ip-tos-rewrite;\n        {# Disables rewriting of IP ToS (Type of Service) field #}\n    }\n}\n\nclass-of-service {\n    {# Classifiers map incoming traffic to forwarding classes based on DSCP or IEEE 802.1p values #}\n    classifiers {\n        dscp cl-dscp-in {\n            {# DSCP classifier for incoming traffic #}\n            forwarding-class fc-assured-forwarding {\n                loss-priority high code-points af21;\n                loss-priority low code-points af41;\n            }\n            forwarding-class fc-best-effort {\n                loss-priority low code-points be;\n            }\n            forwarding-class fc-network-control {\n                loss-priority low code-points [ nc1 nc2 ];\n            }\n            forwarding-class fc-real-time {\n                loss-priority low code-points ef;\n            }\n        }\n        ieee-802.1 cl-8021p-in {\n            {# IEEE 802.1p classifier for incoming traffic #}\n            forwarding-class fc-assured-forwarding {\n                loss-priority high code-points af21;\n                loss-priority low code-points af41;\n            }\n            forwarding-class fc-best-effort {\n                loss-priority high code-points be;\n            }\n            forwarding-class fc-network-control {\n                loss-priority low code-points [ nc1 nc2 ];\n            }\n            forwarding-class fc-real-time {\n                loss-priority low code-points ef;\n            }\n        }\n    }\n\n    {# Code-point aliases for easier reference of DSCP and IEEE 802.1p values #}\n    code-point-aliases {\n        dscp {\n            {# DSCP code point aliases #}\n            af11 001010;\n            af12 001100;\n            af13 001110;\n            af21 010010;\n            af22 010100;\n            af23 010110;\n            af31 011010;\n            af32 011100;\n            af33 011110;\n            af41 100010;\n            af42 100100;\n            af43 100110;\n            be 000000;\n            cs1 001000;\n            cs2 010000;\n            cs3 011000;\n            cs4 100000;\n            cs5 101000;\n            cs6 110000;\n            cs7 111000;\n            ef 101110;\n            nc1 110000;\n            nc2 111000;\n        }\n        ieee-802.1 {\n            {# IEEE 802.1p code point aliases #}\n            af21 010;\n            af31 011;\n            af41 100;\n            be 000;\n            cs1 001;\n            cs2 010;\n            cs3 011;\n            cs4 100;\n            ef 101;\n            nc1 110;\n            nc2 111;\n        }\n    }\n\n    {# Configuration for traffic originating from the device itself #}\n    host-outbound-traffic {\n        forwarding-class fc-network-control;\n        ieee-802.1 {\n            default nc1;\n        }\n    }\n\n    {# Drop profile definition for queue management #}\n    drop-profiles {\n        DP-TAIL {\n            fill-level 0 drop-probability 0;\n            fill-level 100 drop-probability 100;\n        }\n    }\n\n    {# Mapping of forwarding classes to hardware queues #}\n    forwarding-classes {\n        class fc-assured-forwarding queue-num 4;\n        class fc-best-effort queue-num 0;\n        class fc-network-control queue-num 7;\n        class fc-real-time queue-num 5;\n    }\n\n    {# Traffic control profiles for different interface speeds and scenarios #}\n    traffic-control-profiles {\n        TCP_10G {\n            scheduler-map sm-pqos;\n            shaping-rate 10g;\n        }\n        TCP_10G_Remaining {\n            scheduler-map sm-pqos;\n            shaping-rate 10g;\n        }\n        TCP_10G_overheads {\n            scheduler-map sm-pqos;\n            shaping-rate 9800000000;\n        }\n        TCP_1G {\n            scheduler-map sm-pqos;\n            shaping-rate 1g;\n        }\n        TCP_1G_Remaining {\n            scheduler-map sm-pqos;\n            shaping-rate 1g;\n        }\n        TCP_1G_overheads {\n            scheduler-map sm-pqos;\n            shaping-rate 980m;\n        }\n    }\n\n    {# Rewrite rules for modifying DSCP and IEEE 802.1p values on egress #}\n    rewrite-rules {\n        dscp rr-dscp-out {\n            {# DSCP rewrite rules #}\n            forwarding-class fc-assured-forwarding {\n                loss-priority high code-point af21;\n                loss-priority low code-point af41;\n            }\n            forwarding-class fc-best-effort {\n                loss-priority low code-point be;\n            }\n            forwarding-class fc-network-control {\n                loss-priority low code-point nc1;\n            }\n            forwarding-class fc-real-time {\n                loss-priority low code-point ef;\n            }\n        }\n        ieee-802.1 rr-8021p-out {\n            {# IEEE 802.1p rewrite rules #}\n            forwarding-class fc-assured-forwarding {\n                loss-priority high code-point af21;\n                loss-priority low code-point af41;\n            }\n            forwarding-class fc-best-effort {\n                loss-priority low code-point be;\n            }\n            forwarding-class fc-network-control {\n                loss-priority low code-point nc1;\n            }\n            forwarding-class fc-real-time {\n                loss-priority low code-point ef;\n            }\n        }\n    }\n\n    {# Scheduler map linking forwarding classes to schedulers #}\n    scheduler-maps {\n        sm-pqos {\n            forwarding-class fc-assured-forwarding scheduler sc-assured-forwarding;\n            forwarding-class fc-best-effort scheduler sc-best-effort;\n            forwarding-class fc-network-control scheduler sc-network-control;\n            forwarding-class fc-real-time scheduler sc-real-time;\n        }\n    }\n\n    {# Scheduler configurations for each forwarding class #}\n    schedulers {\n        sc-assured-forwarding {\n            transmit-rate percent {{scheduler_values.AF_transmit_rate_percent}};\n            buffer-size temporal {{scheduler_values.AF_buffer_size_temporal}};\n            priority {{scheduler_values.AF_priority}};\n        }\n        sc-best-effort {\n            transmit-rate {\n                {{scheduler_values.BE_transmit_rate}};\n            }\n            buffer-size temporal {{scheduler_values.BE_buffer_size_temporal}};\n            priority {{scheduler_values.BE_priority}};\n        }\n        sc-network-control {\n            shaping-rate percent {{scheduler_values.NC_shaping_rate_percent}};\n            buffer-size percent {{scheduler_values.NC_buffer_size_percent}};\n            priority {{scheduler_values.NC_priority}};\n        }\n        sc-real-time {\n            shaping-rate percent {{scheduler_values.RT_shaping_rate_percent}};\n            buffer-size temporal {{scheduler_values.RT_buffer_size_temporal}};\n            priority {{scheduler_values.RT_priority}};\n        }\n    }\n\n{# Jinja loop to generate interface configurations based on provided parameters #}\n{% for int_name, int_params in interface.items() %}\n    {% for tag in int_params[\"tags\"] %}\n        {# If the interface has a tag that starts with 'TCP_' then the interface config will be rendered and the tag name used #}\n        {% if \"TCP_\" in tag|upper %}\n    interfaces {\n        {{int_params[\"intfName\"]}} {\n            output-traffic-control-profile {{tag|upper}};\n            unit 0 {\n                classifiers {\n                    dscp cl-dscp-in;\n                    ieee-802.1 cl-8021p-in;\n                }\n                rewrite-rules {\n                    dscp rr-dscp-out;\n                    ieee-802.1 rr-8021p-out;\n                }\n            }\n        }\n        {% endif %}\n    {% endfor %} \n{% endfor %}\n}",
    "section": "system",
    "negation_template_text": "",
    "filename": ""
    }
]
}